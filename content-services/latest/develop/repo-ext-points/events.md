---
title: Events Extension Point
---

When implementing business logic an out-of-process model should be used. For example, if some processing should be done
every time a PDF is uploaded to a specific folder, then there is an event that can be subscribed to and the business logic 
can be implemented in an external process separate from the Content Services server process.

Architecture Information: [Platform Architecture]({% link content-services/latest/develop/software-architecture.md %}#platformarch)

## Event Model

The event model in Content Services is a library packaged as a JAR file, which is part of the repository (i.e. `alfresco.war`). 
The library contains the event model and the databind helpers used to help the clients to marshall and unmarshall the events.

The event model is based on the [CloudEvents specification](https://github.com/cloudevents/spec/blob/v1.0/spec.md){:target="_blank"}.
CloudEvents is a specification for describing event data in common formats to provide interoperability across services, 
platforms and systems. For more information see [CloudEvents Primer](https://github.com/cloudevents/spec/blob/v1.0/primer.md){:target="_blank"}.

### CloudEvent attributes

Standard CloudEvent attributes in the context of Content Services events:

| Property             | Type          | Description                                                      |
|----------------------|---------------|------------------------------------------------------------------|
|`type`                |String         |The [Alfresco event type](#alfrescoeventtypes). ([1.0 spec#type](https://github.com/cloudevents/spec/blob/v1.0/spec.md#type){:target="_blank"})|
|`specversion`         |String         |The CloudEvents specification version. Value should be `1.0`. ([1.0 spec#specversion](https://github.com/cloudevents/spec/blob/v1.0/spec.md#specversion){:target="_blank"})|
|`id`                  |String         |Event ID, a UUID generated by the producer ([1.0 spec#id](https://github.com/cloudevents/spec/blob/v1.0/spec.md#id){:target="_blank"})|
|`source`              |URI-reference  |The instance of a repository that produced the event, .i.e. repository cluster node identifier ([1.0 spec#source](https://github.com/cloudevents/spec/blob/v1.0/spec.md#source){:target="_blank"})|
|`time`                |Timestamp      |The producer's timestamp of when the event occurred. ([1.0 spec#time](https://github.com/cloudevents/spec/blob/v1.0/spec.md#time){:target="_blank"})|
|`dataschema`          |URI-reference  |Identifies the schema that data adheres to |
|`datacontenttype`     |String         |The content type of the data attribute. Value should be `application/json`. ([1.0 spec#datacontenttype](https://github.com/cloudevents/spec/blob/v1.0/spec.md#datacontenttype){:target="_blank"})|
|`data`                |JSON           |The domain-specific [data](#acsdata) of the event. ([1.0 spec#data](https://github.com/cloudevents/spec/blob/v1.0/spec.md#data-attribute){:target="_blank"})|

### Content Services event data attributes {#acsdata}

Content Services event data payload/attributes:

TODO: check the type with the schema

| Property             | Type          | Description                                                      |
|----------------------|---------------|------------------------------------------------------------------|
|`data.eventGroupId`   |String         |Optional unique identifier for events group, i.e. a transaction ID|
|`data.resource`       |Object (varies)|The object representing the resource affected. Here the resource represents a node in the Alfresco Repository.|
|`data.resourceBefore` |Object (varies)|The object representing the old values of the changed resource's attributes. Note, this object is only available on the `org.alfresco.event.node.Updated` event type|
|`data.resource.@type` |String|The type of resource object, such as an Alfresco Repository `NodeResource`|
|`data.resource.id`    |String|The Alfresco Repository Node Id for the resource (e.g. node such as folder or file) that the data represent.|
|`data.resource.primaryHierarchy` |Array|Optional primary hierarchy of ancestors of the resource affected, i.e. folder path for the node. Note that the first element is the immediate parent|
|`data.resource.name`             |String|The name of the resource. This is the name of the node, e.g. the name of a folder or a file|
|`data.resource.nodeType`         |String|A content model type, such as `cm:content` for a file or `cm:folder` for a folder. See [content modelling]({% link content-services/latest/develop/repo-ext-points/content-model.md %})|
|`data.resource.createdByUser`    |Object|The name of the user that created the node|
|`data.resource.createdAt`        |String|The time a node was created|
|`data.resource.modifiedByUser`   |Object|The name of the user that modified/updated the node|
|`data.resource.modifiedAt`       |String|The time a node was modified/updated|
|`data.resource.content`          |Object|If the node is of content type `cm:content` (i.e. a file), then this object contains information about the file, such as MIME-type and size.|
|`data.resource.properties`       |Array|Content model properties corresponding to the `data.resource.nodeType`.|
|`data.resource.aspectNames`      |Array|Content model aspects that have been applied to the node.|
|`data.resource.isFolder`         |Boolean|`true` if this node is of type `cm:folder`|
|`data.resource.isFile`           |Boolean|`true` if this node is of type `cm:content`|
|`data.resource.resourceReaderAuthorities`|Array|Authorities that can read this resource, such as `GROUP_EVERYONE`, which means anybody can read the data.|
|`data.resource.resourceDeniedAuthorities`|Array|Authorities that cannot access this data.|

For a detailed view of the event data refer to [Repo Event JSON schema](https://github.com/Alfresco/acs-event-model/tree/master/src/main/resources/json-schema){:target="_blank"}.

### Event Types {#alfrescoeventtypes}

The following are the different types of events that can be subscribed to:

| Name                              | Description                                                      |
|-----------------------------------|------------------------------------------------------------------|
| `org.alfresco.event.node.Created` | Occurs when a node is created |
| `org.alfresco.event.node.Updated` | Occurs when a node is updated or moved. Currently only node's name, type, properties, aspects, and content are supported|
| `org.alfresco.event.node.Deleted` | Occurs when a node is deleted |
| `org.alfresco.event.assoc.child.Created` | Occurs when a secondary child association is created |
| `org.alfresco.event.assoc.child.Deleted` | Occurs when a secondary child association is deleted |
| `org.alfresco.event.assoc.peer.Created` | Occurs when a peer association is created |
| `org.alfresco.event.assoc.peer.Deleted` | Occurs when a peer association is deleted |

## Event Descriptions

Let's have a look at each event and see what we can use it for when implementing business logic for a 
particular content domain.

### Node Created Event

This event is fired whenever a node, such as a folder or file, is created in the repository. The full name of this 
event is `org.alfresco.event.node.Created`. 

The following is an example of the payload for this event `type`, in this case the payload is telling us that a file called
`purchase-order-scan.pdf` (i.e. `name`) of type `cm:content` (i.e. `nodeType`) was uploaded by the user `admin` 
(i.e. `createdByUser.id`) to the **/Company Home/Testing/Inbound** folder (i.e. `primaryHierarchy[0]`):

```json
{
  "specversion": "1.0",
  "type": "org.alfresco.event.node.Created",
  "id": "368818d9-dddd-4b8b-8eab-e050253d7f61",
  "source": "/08d9b620-48de-4247-8f33-360988d3b19b",
  "time": "2021-01-21T11:14:16.42372Z",
  "dataschema": "https://api.alfresco.com/schema/event/repo/v1/nodeCreated",
  "datacontenttype": "application/json",
  "data": {
    "eventGroupId": "4004ca99-9d2a-400d-9d80-8f840e223581",
    "resource": {
      "@type": "NodeResource",
      "id": "d71dd823-82c7-477c-8490-04cb0e826e65",   /app:company_home/cm:Testing/cm:Inbound/cm:purchase-order-scan.pdf (cm:content)
      "primaryHierarchy": [
        "5f355d16-f824-4173-bf4b-b1ec37ef5549",       /app:company_home/cm:Testing/cm:Inbound  (cm:folder)
        "93f7edf5-e4d8-4749-9b4c-e45097e2e19d",       /app:company_home/cm:Testing             (cm:folder)
        "c388532e-8da6-4d50-a6d2-4f3f3ac36ff7",       /app:company_home                        (cm:folder)
        "2fa2cde5-9d83-4460-a38c-cfe4ec9cca08"        Store root                               (sys:store_root)
      ],
      "name": "purchase-order-scan.pdf",
      "nodeType": "cm:content",
      "createdByUser": {
        "id": "admin",
        "displayName": "Administrator"
      },
      "createdAt": "2021-01-21T11:14:15.695Z",
      "modifiedByUser": {
        "id": "admin",
        "displayName": "Administrator"
      },
      "modifiedAt": "2021-01-21T11:14:15.695Z",
      "content": {
        "mimeType": "application/pdf",
        "sizeInBytes": 531152,
        "encoding": "UTF-8"
      },
      "properties": {
        "cm:autoVersion": true,
        "cm:versionType": "MAJOR",
        "cm:autoVersionOnUpdateProps": false,
        "cm:versionLabel": "1.0",
        "cm:initialVersion": true
      },
      "aspectNames": [
        "cm:versionable",
        "cm:auditable"
      ],
      "isFolder": false,
      "isFile": true
    },
    "resourceReaderAuthorities": [
      "GROUP_EVERYONE"
    ],
    "resourceDeniedAuthorities": []
  }
}
```

When subscribing to this event it's possible to filter out anything that is
not of interest. So for example, if you are interested in files with content type `cm:content` uploaded to a folder 
called **/Company Home/Testing/Inbound** (Alfresco NodeRef=`5f355d16-f824-4173-bf4b-b1ec37ef5549`) it would be easy to 
configure this. The following code snippet shows how this could be done with an 
[Apache Camel route](https://camel.apache.org/manual/latest/routes.html){:target="_blank"} configuration:

```java
public class SimpleRoute extends RouteBuilder {

    @Override
    public void configure() {

        from("amqpConnection:topic:alfresco.repo.event2")
            .id("NewFilesRoute")
            .log("${body}") 
            .choice() 
            .when() 
                .jsonpath("$[?(@.type=='org.alfresco.event.node.Created' && " +
                        "@.data.resource.nodeType=='cm:content' && " +
                        "'5f355d16-f824-4173-bf4b-b1ec37ef5549' in @.data.resource.primaryHierarchy[:1])]") 
            .unmarshal("publicDataFormat") 
            .bean("eventHandlerImpl", "onReceive(*, COPY)") 
            .end();
    }

    private String createJsonPathQuery()
    {
        return "$[?(@.type=='org.alfresco.event.node.Created' && @.data.resource.nodeType=='cm:content' && '5f355d16-f824-4173-bf4b-b1ec37ef5549' in @.data.resource.primaryHierarchy[:1])]";
    }
}

```



TODO: do your own test where we know the folder and file etc, so we can relate...

```json
{
  "specversion": "1.0",
  "type": "org.alfresco.event.node.Created",
  "id": "97c1b36c-c569-4c66-8a31-7a8d0b6b804a",
  "source": "/f6d21231-618e-4f12-a920-e498660c5b9d",
  "time": "2020-04-27T12:37:03.560134+01:00",
  "dataschema": "https://api.alfresco.com/schema/event/repo/v1/nodeCreated",
  "datacontenttype": "application/json",
  "data": {
    "eventGroupId": "cb645043-e7d2-4e51-b61d-e6d01582cbab",
    "resource": {
      "id": "7491120a-e2cb-478f-8599-ebf057cc0c7c",
      "name": "testFile.txt",
      "nodeType": "cm:content",
      "isFolder": false,
      "isFile": true,
      "createdByUser": {
        "id": "john.doe",
        "displayName": "John Doe"
      },
      "createdAt": "2020-04-27T12:37:03.555624+01:00",
      "modifiedByUser": {
        "id": "jane.doe",
        "displayName": "Jane Doe"
      },
      "modifiedAt": "2020-04-27T12:37:03.557956+01:00",
      "content": {
        "mimeType": "text/plain",
        "sizeInBytes": 16,
        "encoding": "UTF-8"
      },
      "primaryHierarchy": [
        "521aac1c-20eb-444b-a137-2da3d35ee1a8",
        "2641bbe1-39ff-44dc-b47f-736552ad46cc"
      ],
      "properties": {
        "cm:title": "test title"
      },
      "aspectNames": [
        "cm:titled",
        "cm:auditable"
      ]
    }
  }
}
```

 